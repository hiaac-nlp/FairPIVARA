#!/bin/bash
###############################################################
# Program Name: show_bias.sh                      Version: 1.0
#
# Description:
#  - Bash file to run the FairPIVARA tests
#
# Usage: Use to run the reports and results of FairPIVARA, after remove the
#         dimensions, using FairPIVARA_select_dimensions.sh
#
# Author: Diego Moreira          Last Update Date: 28/08/2024   
#
#
# Revision History
#
# Version                 Date                  Who
#-------------------------------------------------------------
#
###############################################################
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢀⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⣬⠷⣶⡖⠲⡄⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
# ⠀⠀⠀⠀⠀⠀⠀⣠⠶⠋⠁⠀⠸⣿⡀⠀⡁⠈⠙⠢⠤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀<----⠀FAIR⠀<(˶ᵔᵕᵔ˶)>⠀⠀⠀⠀⠀⠀⠀⠀⠀
# ⠀⠀⠀⠀⠀⢠⠞⠁⠀⠀⠀⠀⠀⠉⠣⠬⢧⠀⠀⠀⠀⠈⠻⣤⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
# ⠀⠀⠀⢀⡴⠃⠀⠀⢠⣴⣿⡿⠀⠀⠀⠐⠋⠀⠀⠀⠀⠀⠀⠘⠿⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
# ⠀⢀⡴⠋⠀⠀⠀⠀⠈⠉⠉⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠒⠒⠓⠛⠓⠶⠶⢄⣀⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
# ⢠⠎⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠙⠦⣀⠀⠀⠀⠀⠀⠀⠀⠀
# ⡞⡀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠸⢷⡄⠀⠀⠀⠀⠀⠀
# ⢻⣇⣹⣿⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠙⢦⡀⠀⠀⠀⠀
# ⠀⠻⣟⠋⠀⠀⠀⠀⠀⣀⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠻⣄⠀⠀⠀
# ⠀⠀⠀⠉⠓⠒⠊⠉⠉⢸⡙⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡀⠀⠀⠀⠀⠘⣆⠀⠀
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣱⡄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣿⠀⠀⠀⠀⠀⢻⡄⠀
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠟⣧⡀⠀⠀⢀⡄⣀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⡿⠇⠀⠀⠀⠀⠀⠀⢣⠀
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠠⡧⢿⡀⠚⠿⢻⡆⠀⠀⠀⠀⠀⢠⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣿⡇⠀⠀⠀⠀⠀⠀⠀⠘⡆
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠘⣿⠀⠀⠈⢹⡀⠀⠀⠀⠀⣾⡆⠀⠀⠀⠀⠀⠀⠀⠀⠾⠇⠀⠀⠀⠀⠀⠀⠀⠀⠀⡇
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠨⢷⣾⠀⠸⡷⠀⠀⠀⠘⡿⠂⠀⠀⠀⢀⡴⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⡇
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡄⠳⢼⣧⡀⠀⠀⢶⡼⠦⠀⠀⠀⡞⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⠃
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢸⡇⠀⡎⣽⠿⣦⣽⣷⠿⠒⠀⠀⠀⣇⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⠀
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣸⠁⣴⠃⡿⠀⠀⢠⠆⠢⡀⠀⠀⠀⠈⢧⣄⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⢠⠇⠀
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣀⣠⣠⠏⠀⣸⢰⡇⠀⢠⠏⠀⠀⠘⢦⣀⣀⠀⢀⠙⢧⡀⠀⠀⠀⠀⠀⠀⠀⠀⡰⠁⠀⠀
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠾⠿⢯⣤⣆⣤⣯⠼⠀⠀⢸⠀⠀⠀⠀⠀⣉⠭⠿⠛⠛⠚⠟⡇⠀⠀⣀⠀⢀⡤⠊⠀⠀⠀⠀
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠈⠉⠀⢸⣷⣶⣤⣦⡼⠀⠀⠀⣴⣯⠇⡀⣀⣀⠤⠤⠖⠁⠐⠚⠛⠉⠁⠀⠀⠀⠀⠀⠀
# ⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⣛⠁⢋⡀⠀⠀⠀⠀⣛⣛⠋⠁⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀⠀
###############################################################

# General Variables
TASK='by_concept' # 'by_concept' or 'cross_concept'

FT_OPEN_CLIP='False' #Used in pt fine-tuning
GPU=1
DATASET_PATH='../MMBias-main/data'
RUDE_LEVEL=1 # Political (1) or non-political bias dataset
CONCEPTS='Disability/Mental|Disability,Disability/Non-Disabled,Disability/Physical|Disability,Nationality/American,Nationality/Arab,Nationality/Chinese,Nationality/Mexican,Religion/Buddhist,Religion/Christian,Religion/Hindu,Religion/Jewish,Religion/Muslim,Sexual|Orientation/Heterosexual,Sexual|Orientation/LGBT' # Concepts used in classification  (| for space and , for and)
LANGUAGE='en' # "en", "pt-br"
PRINT='exel' #'json' , 'exel', 'pandas'  #pandas used to violin plots
SCORE_OR_QUANT=both #'both_operation (with mean), both'
WEIGHTED_LIST='False'
EXTRACT_TOP_SIMILAR='15'  # '', '15' Number of terms considered
VIEW_TOP_SIMILAR='15'  #Number of terms considered in view. For exel, we used '15'. For the violin, it is necessary to have value ''. 
TOP_TYPE='top' # 'top', 'equal' # The firsts ones or per type # equal don't work with pandas print
REMOVE_DIMENSIONS_LIST='' # List of dimensions to be removed : '' , 'results/theta-001to005/results_theta_same_values.txt'
# Specific Variables
if [[ $TASK = 'by_concept' ]]
then
    # By Concepts Variables
    BIAS_TYPE='same_as_selected' # Type of remotions for text. 'same_as_selected','random_text','random' Used with remove-dimensions-list, if remove-dimensions-list is empty, this parameter is ignored
    REPETITIONS=1000 # number of times the algorithm is repeated 
else
    # Cross Concepts Variables
    REPEAT_TIMES='1000' # number of times the algorithm is repeated. To use more than one use a list of values like '1,10,100,1000'  (| for space and , for and)
    FILE_READ='multiple_sets' # File reading type 'multiple_sets, same_set'
    BIAS_TYPE='same_as_X' # Type of remotions for text. random, random_A_B, same_as_X, none
    FILE_WITH_DIMENSIONS='src/result_example/results_theta_0-05_same_values.txt'  # File with the dimensions to be removed #'results/theta-001to005/results_theta_0-05.txt', 'results/theta-001to005/results_theta_same_values.txt', 'results/theta-001to005/together/005-results_theta_calculation_together.txt'
    EMBEDDING_DIMENSIONS=512
fi


echo "FT_OPEN_CLIP: ${FT_OPEN_CLIP}, GPU: ${GPU}, DATASET_PATH: ${DATASET_PATH}, RUDE_LEVEL: ${RUDE_LEVEL}, CONCEPTS: ${CONCEPTS}, LANGUAGE: ${LANGUAGE}, TASK: ${TASK}, PRINT: ${PRINT}, SCORE_OR_QUANT: ${SCORE_OR_QUANT}, WEIGHTED_LIST: ${WEIGHTED_LIST}, EXTRACT_TOP_SIMILAR: ${EXTRACT_TOP_SIMILAR}, VIEW_TOP_SIMILAR: ${VIEW_TOP_SIMILAR}, TOP_TYPE: ${TOP_TYPE}, REMOVE_DIMENSIONS_LIST: ${REMOVE_DIMENSIONS_LIST}, REPETITIONS: ${REPETITIONS}, BIAS_TYPE: ${BIAS_TYPE}"

PYTHON="python3"

if [[ $TASK = 'by_concept' ]]
then
  ${PYTHON} src/show_bias.py \
    --ft-open-clip=${FT_OPEN_CLIP} \
    --dataset-path=${DATASET_PATH} \
    --rude-level=${RUDE_LEVEL} \
    --concepts=${CONCEPTS} \
    --task=${TASK} \
    --language=${LANGUAGE} \
    --weighted-list=${WEIGHTED_LIST} \
    --gpu=${GPU} \
    --print=${PRINT} \
    --score-or-quant=${SCORE_OR_QUANT} \
    --extract-top-similar=${EXTRACT_TOP_SIMILAR} \
    --view-top-similar=${VIEW_TOP_SIMILAR} \
    --top-type=${TOP_TYPE} \
    --remove-dimensions-list=${REMOVE_DIMENSIONS_LIST} \
    --repetitions=${REPETITIONS} \
    --bias-type=${BIAS_TYPE}
else
  ${PYTHON} src/show_bias.py \
    --ft-open-clip=${FT_OPEN_CLIP} \
    --dataset-path=${DATASET_PATH} \
    --rude-level=${RUDE_LEVEL} \
    --concepts=${CONCEPTS} \
    --task=${TASK} \
    --language=${LANGUAGE} \
    --weighted-list=${WEIGHTED_LIST} \
    --gpu=${GPU} \
    --print=${PRINT} \
    --score-or-quant=${SCORE_OR_QUANT} \
    --extract-top-similar=${EXTRACT_TOP_SIMILAR} \
    --view-top-similar=${VIEW_TOP_SIMILAR} \
    --top-type=${TOP_TYPE} \
    --remove-dimensions-list=${REMOVE_DIMENSIONS_LIST} \
    --bias-type=${BIAS_TYPE} \
    --repeat-times=${REPEAT_TIMES} \
    --file-read=${FILE_READ} \
    --file-with_dimensions=${FILE_WITH_DIMENSIONS} \
    --embedding-dimensions=${EMBEDDING_DIMENSIONS}
fi

